# Ansible
Ansible is currently being used to remotely interact with multiple computers at the same time. This gives you the ability to push out commands, install software, etc. with multiple computers at the same time. Each YAML file performs a different function to a specific group of hosts. 

## Install
When first cloning the repository, run the `install.sh` script to add any needed dependencies.

To only install the dependencies needed for Ansible, run `bash install.sh`. To install dependencies, Ansible, and the plugins needed, run `bash install.sh -f` for a full install. To install dependencies needed to interact with Windows machines, run `bash install.sh -w`. 

## Creating Hosts List
A list of hosts must first be generated to a text file also named `hosts`. This list must be generated regularly (preferably daily), so that's why the `hosts` file is not included in this repository. The hosts file is generated by running `bash getHosts.sh`. These three groups can be used for organization purposes:

* `debian` - Debian and Ubuntu hosts that are powered on
* `windows` - Windows hosts that are powered on
* `other` - all other machines

This script also checks for `~/.ansible.cfg` and will automatically generate it if it doesn't exist.

## Running Scripts

To use a yaml playbook for Linux servers, the command is: 

`ansible-playbook {playbook-name}.yaml --ask-pass`

(If you are running the ADJoin.yaml script, you will more than likely need to add `-u admin` to the above command as your user will not be on the machine you are attempting to add to the domain.)

To use a yaml playbook for Windows servers, the command is:

`ansible-playbook {playbook-name}.yaml`

If you get an error that says it needs an SSH fingerprint first, you can run the command `ssh-keyscan -f hosts >> ~/.ssh/known_hosts` and that should resolve it.

If any machines are reported as unreachable, then they must be reconfigured. All Debian and Ubuntu machines should be accessible from the security engineer's account (either AD or local if AD doesn't work) with sudo permissions.

## Contents
Scripts are sorted into different folders according to their purpose. To see usage or more specific documentation for a file, click on the link or open the folder containing it. 

Each YAML file has a default group of computers found in the `hosts` file. These may be temporarily edited as needed.

### Current Directory
These are the files not in a folder:

* getHosts.sh
    * Creates a list of hosts stored in the `hosts` file. See the "Creating Hosts List" section.
* header.yaml
    * Generic header used for formatting output of YAML scripts. Used by several different programs.
* helpfulSecurityCommands
    * List of helpful security commands
* hosts (should not be posted to GitHub)
    * Ansible host list, not included in the repository based on `.gitignore` so that the host list isn't accidentally published.
* install.sh
    * Installs ansible and needed dependencies. See the "Install" section.

### [Account Management](account_management/)
These scripts deal with user management and server authentication:

* ADJoin.yaml
* changePassword.yaml
* deleteUser.yaml
* newUser.yaml

### [Installs](installs/)
These scripts deal with installing packages on multiple Linux machines:

* install.yaml
* uninstall.yaml

### [Exploitation Prevention](exploitation_prevention/)
These scripts help minimize exploits and misconfigurations in Linux machines:

* allAccountsAndServices.yaml
* aptSources.yaml
* update1-listUpgrades.yaml
* update2-updatePackages.yaml
* update3-restartServices.yaml
* update4-listNeededReboots.yaml
* update5-rebootServers.yaml
* winInstallUpdates.yaml

### [Privilege Escalation Prevention](privilege_escalation_prevention/)
These scripts help minimize privilege escalation paths in Linux machines:

* auditPermissions.yaml
* getWorldWritable.yaml